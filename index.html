<!doctype html>
<html lang="en" class="dark">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Rocket City Jerky ‚Ä¢ Space-themed, boldly flavored</title>
  <meta name="color-scheme" content="dark" />
  <style>
    #bgfx{position:fixed;inset:0;z-index:-1;opacity:.3}

/* Planets canvas sits under hero labels, above hero gradient */
#planetsfx{
  position:absolute;
  inset:0;
  width:100%;
  height:100%;
  z-index:0;           /* hero text stays above it */
  pointer-events:none; /* doesn‚Äôt block clicks */
}

    :root{
      --bg:#05060a; --panel:rgba(255,255,255,.04); --border:rgba(255,255,255,.12);
      --text:#fff; --muted:rgba(255,255,255,.7);
      --indigo:#6366f1; --cyan:#06b6d4; --pink:#db2777;
    }
    *{box-sizing:border-box}
    html,body{height:100%;}
    body{margin:0;font:14px/1.4 system-ui,-apple-system,Segoe UI,Roboto,Ubuntu; background:var(--bg); color:var(--text);}
    a{color:var(--text);text-decoration:none}
    button{font:inherit}

    .container{max-width:1200px;margin:0 auto;padding:1.25rem}
    .navbar{position:sticky;top:0;z-index:30;height:56px;display:flex;align-items:center;justify-content:space-between;padding:0 1rem;
      background:rgba(0,0,0,.55);backdrop-filter:blur(8px);border-bottom:1px solid var(--border)}
    .nav-left{display:flex;align-items:center;gap:.75rem}
    .brand{font-weight:700;letter-spacing:.08em}
    .nav-link{opacity:.8}
    .nav-link:hover{opacity:1}
    .btn{display:inline-flex;align-items:center;gap:.5rem;padding:.5rem .9rem;border-radius:.5rem;border:1px solid transparent;
      background:var(--indigo);color:#fff;cursor:pointer;transition:transform .06s ease, background .2s ease}
    .btn:active{transform:translateY(1px)}
    .btn-ghost{background:transparent;border:1px solid var(--border);color:#fff}

    .hero{position:relative;aspect-ratio:21/9;border:1px solid var(--border);border-radius:12px;overflow:hidden}
    .hero-gradient{position:absolute;inset:0;background:linear-gradient(to top, rgba(0,0,0,.7), transparent 60%)}
    .hero-inner{position:absolute;inset:0;display:grid;place-items:end;padding:2rem}
    .hero h1{font-size:2rem;margin:0 0 .35rem 0}

    .row{margin-top:1rem}
    .grid{display:grid;grid-template-columns:repeat(4,minmax(0,1fr));gap:.75rem}
    .pitem{border:1px solid var(--border);border-radius:10px;background:var(--panel);padding:.75rem;display:flex;flex-direction:column;gap:.4rem}
    .price{font-weight:600}

    /* Cart drawer */
    .drawer{position:fixed;right:0;top:0;height:100dvh;width:min(420px,100%);background:#0b0d14;border-left:1px solid var(--border);
      transform:translateX(100%);transition:transform .25s ease;z-index:40;display:flex;flex-direction:column}
    .drawer.open{transform:translateX(0)}
    .drawer header{display:flex;align-items:center;justify-content:space-between;padding:1rem;border-bottom:1px solid var(--border)}
    .drawer main{flex:1;overflow:auto;padding:1rem}
    .drawer footer{padding:1rem;border-top:1px solid var(--border)}

    /* Transition overlay (non-blocking) */
    .transition{pointer-events:none;position:fixed;inset:0;z-index:40;opacity:0;transition:opacity .18s ease}
    #smokefx{width:100%;height:100%;display:block}

    #bgfx{position:fixed;inset:0;z-index:-1;opacity:.9}
    .input{background:transparent;border:1px solid var(--border);border-radius:.5rem;padding:.45rem .6rem;color:#fff}
/* Planets canvas sits under hero labels, above hero gradient */
#planetsfx{
  position:absolute;
  inset:0;
  width:100%;
  height:100%;
  z-index:0;           /* hero text uses higher z-index via normal flow */
  pointer-events:none; /* never block clicks */
}

    /* hide unwanted labels */
    .badge{display:none}

    /* Mobile polish */
    @media (max-width: 640px){
      .container{padding:.75rem}
      .hero{aspect-ratio:16/9}
      .hero h1{font-size:1.5rem}
      .grid{grid-template-columns:repeat(2,minmax(0,1fr));gap:.5rem}
      .nav-right{display:none}
    }
    @media (prefers-reduced-motion: reduce){ .transition{transition:none} }
  </style>
</head>
<body>
  <!-- starfield canvas -->
  <canvas id="bgfx" aria-hidden="true"></canvas>

  <!-- navbar -->
  <div class="navbar" role="navigation">
    <div class="nav-left">
      <a class="brand" href="#" data-route="home">üöÄ Rocket City Jerky</a>
      <a class="nav-link" href="#" data-route="home">Home</a>
      <a class="nav-link" href="#shop" data-route="shop">Shop</a>
    </div>
    <div class="nav-right" style="display:flex;align-items:center;gap:.5rem">
      <button class="btn-ghost btn" id="cartBtn" aria-haspopup="dialog" aria-controls="cartDrawer">Cart <span id="cartCount" class="badge">0</span></button>
    </div>
  </div>

  <div class="container">
    <!-- Mission Statement -->
    <section class="row" id="mission" aria-label="Mission Statement" style="margin-bottom:.5rem">
      <h2 style="margin:0 0 .5rem 0; font-size:1.25rem;">Our Mission</h2>
      <p style="color:var(--muted);max-width:70ch">
       From Building Rockets to - <strong>Rocket City Jerky</strong>, we fuse space-city grit with small-batch craft.
        Every bag fuels adventure‚Äîat work, on the road, or under a sky full of stars.
        Flavors range from low-orbit mild to supernova heat.
      </p>
    </section>

    <!-- HERO -->
    <section class="hero" aria-label="Featured" id="hero">
      <!-- Realistic Planet Fly-by -->
<canvas id="planetsfx" aria-hidden="true"></canvas>
      <div class="hero-gradient"></div>
      <div class="hero-inner">
        <div>
          <h1>Rocket City Jerky</h1>
          <p class="muted">Top Sellers & Deals rotate here.</p>
        </div>
      </div>
    </section>

    <!-- SHOP -->
    <section class="row" id="shop" aria-label="Shop">
      <!-- Tabs -->
      <div id="cat-tabs" style="display:flex;gap:.5rem;flex-wrap:wrap;margin:.75rem 0 1rem">
        <button class="btn-ghost btn" data-cat="Space Craft">üöÄ Space Craft</button>
        <button class="btn-ghost btn" data-cat="Galaxies">üåå Galaxies (Mild)</button>
        <button class="btn-ghost btn" data-cat="Stars">‚ú® Stars (Intense)</button>
        <button class="btn-ghost btn" data-cat="Mission Patches">üéñÔ∏è Mission Patches</button>
      </div>

      <!-- Search + Sort -->
      <div id="filter-row" style="display:flex;gap:.5rem;align-items:center;margin:.5rem 0 1rem">
        <input class="input" id="shop-search" placeholder="Search flavors‚Ä¶" aria-label="Search products" />
        <select class="input" id="shop-sort" aria-label="Sort">
          <option value="popular">Sort: Popular</option>
          <option value="price-asc">Price: Low ‚Üí High</option>
          <option value="price-desc">Price: High ‚Üí Low</option>
          <option value="name-asc">Name: A ‚Üí Z</option>
        </select>
      </div>

      <!-- Grid + Pager -->
      <div class="grid" id="product-grid"></div>
      <div id="pager" style="display:flex;justify-content:center;gap:.35rem;margin-top:1rem"></div>
    </section>
  </div>

  <!-- Cart Drawer -->
  <aside class="drawer" id="cartDrawer" role="dialog" aria-modal="true" aria-labelledby="cartTitle">
    <header>
      <h3 id="cartTitle">Your Cart</h3>
      <button class="btn-ghost btn" id="closeCartBtn" aria-label="Close cart">Close</button>
    </header>
    <main id="cartItems"></main>
    <footer>
      <div style="display:flex;align-items:center;justify-content:space-between">
        <strong>Total: $<span id="cartTotal">0.00</span></strong>
        <button class="btn" id="checkoutBtn">Checkout</button>
      </div>
      <p class="muted" style="color:var(--muted);margin:.5rem 0 0">
        Payments: add Stripe Payment Links in the script to enable checkout.
      </p>
    </footer>
  </aside>

  <!-- Transition overlay (smoke canvas) -->
  <div class="transition" id="transition">
    <canvas id="smokefx" width="0" height="0"></canvas>
  </div>

  <!-- App: catalog + cart + missions + hero -->
  <script>
  (function(){
    /* Optional: Stripe Payment Links (set URLs to enable checkout) */
    const PAYMENT_LINKS = { m1:"", m2:"", m3:"", m4:"", m5:"" };
    const PRICE_PER_PACK = 13.99; // used for mission bundle price in cart

    /* Catalog data */
    const PRODUCTS = [
      /* Space Craft */
      { id:"sc-obp-8",  title:"Orion‚Äôs Belt ‚Äî Black Pepper (8oz)", price:12.99, cat:"Space Craft", heat:"mild",    popular:95 },
      { id:"sc-hs-8",   title:"Honey Sriracha (8oz)",               price:13.99, cat:"Space Craft", heat:"medium",  popular:90 },
      { id:"sc-tc-8",   title:"Teriyaki Comet (8oz)",               price:12.99, cat:"Space Craft", heat:"mild",    popular:85 },
      { id:"sc-gg-12",  title:"Galactic Garlic (12oz)",             price:17.99, cat:"Space Craft", heat:"mild",    popular:80 },
      { id:"sc-ssh-8",  title:"Stellar Sweet Heat (8oz)",           price:14.99, cat:"Space Craft", heat:"medium",  popular:78 },
      { id:"sc-sn-8",   title:"Supernova BBQ (8oz)",                price:14.99, cat:"Space Craft", heat:"mild",    popular:72 },
      { id:"sc-ml-8",   title:"Meteor Lime (8oz)",                  price:13.99, cat:"Space Craft", heat:"medium",  popular:70 },
      { id:"sc-aa-8",   title:"Andromeda Applewood (8oz)",          price:15.99, cat:"Space Craft", heat:"mild",    popular:68 },

      /* Galaxies (mild) */
      { id:"gal-mh-12", title:"Mango Habanero (12oz)",              price:16.99, cat:"Galaxies",    heat:"mild",    popular:98 },
      { id:"gal-ao-8",  title:"Astro Original (8oz)",               price:12.99, cat:"Galaxies",    heat:"mild",    popular:88 },
      { id:"gal-ss-8",  title:"Saturn Smoke (8oz)",                 price:14.99, cat:"Galaxies",    heat:"mild",    popular:76 },
      { id:"gal-ll-8",  title:"Lunar Lemon (8oz)",                  price:13.99, cat:"Galaxies",    heat:"mild",    popular:74 },

      /* Stars (intense) */
      { id:"st-bhh-8",  title:"Black Hole Hot (8oz)",               price:15.99, cat:"Stars",       heat:"intense", popular:97 },
      { id:"st-ij-8",   title:"Ion Jalape√±o (8oz)",                 price:13.99, cat:"Stars",       heat:"intense", popular:84 },
      { id:"st-ccp-8",  title:"Comet Chipotle (8oz)",               price:14.99, cat:"Stars",       heat:"intense", popular:83 },
      { id:"st-nn-12",  title:"Nebula Nitro (12oz)",                price:18.99, cat:"Stars",       heat:"intense", popular:81 },
    ];
    window.PRODUCTS = PRODUCTS;

    /* Missions */
    const MISSIONS = [
      { id:"m1", title:"Mission 1 ‚Äî Liftoff",      packs:3,   reward:"Mission patch",
        story:"Your journey begins on the launch pad. Three packs‚Äîchoose flavors and light the fuse." },
      { id:"m2", title:"Mission 2 ‚Äî Refuel",       packs:5,   reward:"Mission patch",
        story:"Cleared the tower. Keep tanks topped‚Äîfive packs any way you like to extend burn." },
      { id:"m3", title:"Mission 3 ‚Äî Exoplanetary", packs:10,  reward:"Mission patch",
        story:"Past the heliopause‚Äîchart new taste worlds with a 10-pack explorer set." },
      { id:"m4", title:"Mission 4 ‚Äî Interstellar", packs:40,  reward:"Limited company patch",
        story:"For crews/companies: a cargo bay for the whole flight deck‚Äîforty bags." },
      { id:"m5", title:"Mission 5 ‚Äî Limited Coin", packs:100, reward:"Limited edition coin",
        story:"Legend status. A commemorative coin for century-pack captains." },
    ];

    /* DOM */
    const grid = document.getElementById("product-grid");
    const pager = document.getElementById("pager");
    const tabs  = document.getElementById("cat-tabs");
    const searchInput = document.getElementById("shop-search");
    const sortSel = document.getElementById("shop-sort");
    const filterRow = document.getElementById("filter-row");
    const PAGE_SIZE = 8;

    /* Router */
    function getState(){
      const url = new URL(location.href);
      return {
        cat:  url.searchParams.get("cat") || "Space Craft",
        q:    url.searchParams.get("q") || "",
        sort: url.searchParams.get("sort") || "popular",
        page: Math.max(1, parseInt(url.searchParams.get("page") || "1", 10)),
      };
    }
    function setState(next){
      const url = new URL(location.href);
      for (const [k,v] of Object.entries(next)){
        if (v==="" || v==null) url.searchParams.delete(k);
        else url.searchParams.set(k, String(v));
      }
      history.pushState({}, "", url);
      render();
    }
    window.addEventListener("popstate", render);

    /* Catalog */
    function applyFilters(items, st){
      let out = items.slice();
      if (st.cat && st.cat !== "Mission Patches") out = out.filter(p => p.cat === st.cat);
      if (st.q) { const q = st.q.toLowerCase(); out = out.filter(p => p.title.toLowerCase().includes(q)); }
      switch (st.sort){
        case "price-asc":  out.sort((a,b)=>a.price-b.price); break;
        case "price-desc": out.sort((a,b)=>b.price-a.price); break;
        case "name-asc":   out.sort((a,b)=>a.title.localeCompare(b.title)); break;
        default:           out.sort((a,b)=>b.popular-a.popular);
      }
      return out;
    }
    function renderGrid(items){
      grid.innerHTML = items.map(p => `
        <div class="pitem" data-id="${p.id}">
          <div style="height:130px;border-radius:8px;background:linear-gradient(135deg,#1d2340,#44235a);display:grid;place-items:center;font-weight:700">${p.cat}</div>
          <div style="font-weight:600">${p.title}</div>
          <div class="price">$${p.price.toFixed(2)}</div>
          <button class="btn add">Add to Cart</button>
        </div>
      `).join("");
    }
    function renderPager(total, st){
      const pages = Math.max(1, Math.ceil(total / PAGE_SIZE));
      const cur = Math.min(st.page, pages);
      let html = "";
      const mk = (label, page, disabled=false, active=false) =>
        `<button class="btn-ghost btn" data-page="${page}" ${disabled?"disabled":""} style="${active?"border-color:#6366f1":""}">${label}</button>`;
      html += mk("¬´", 1, cur===1);
      html += mk("‚Äπ", Math.max(1, cur-1), cur===1);
      for (let i=1;i<=pages;i++){
        const show = (i<=2) || (i>pages-2) || (Math.abs(i-cur)<=1);
        if (i===3 && cur>4) { html += `<span style="opacity:.6">‚Ä¶</span>`; continue; }
        if (i===pages-2 && cur<pages-3) { html += `<span style="opacity:.6">‚Ä¶</span>`; continue; }
        if (show) html += mk(String(i), i, false, i===cur);
      }
      html += mk("‚Ä∫", Math.min(pages, cur+1), cur===pages);
      html += mk("¬ª", pages, cur===pages);
      pager.innerHTML = html;
    }

    /* Missions */
    function ensureBundleProduct(id, title, price){
      if (!PRODUCTS.find(p=>p.id===id)){
        PRODUCTS.push({ id, title, price, cat:"Mission Patches", heat:"", popular:50 });
      }
    }
    function renderMissions(){
      pager.style.display = "none";
      if (filterRow) filterRow.style.display = "none";
      grid.innerHTML = MISSIONS.map(m => `
        <div class="pitem" data-mission="${m.id}">
          <div style="height:130px;border-radius:8px;background:linear-gradient(135deg,#1d2340,#44235a);display:grid;place-items:center;font-weight:700">
            üéñÔ∏è ${m.title}
          </div>
          <div style="margin-top:.35rem">
            <div style="font-weight:600">Requirement: ${m.packs} packs</div>
            <div style="color:var(--muted);font-size:.9rem;margin-top:.25rem">Reward: ${m.reward}</div>
          </div>
          <details style="margin:.35rem 0 0 0; border:1px solid var(--border); border-radius:8px; padding:.5rem; background:var(--panel)">
            <summary style="cursor:pointer; outline:none">Read story</summary>
            <p style="color:var(--muted); margin:.5rem 0 0 0">${m.story}</p>
          </details>
          <div style="display:flex;gap:.5rem;flex-wrap:wrap;margin-top:.5rem">
            <button class="btn" data-cta="${m.id}">Join Mission</button>
            <button class="btn-ghost btn" data-cta-cart="${m.id}">Add to Cart (bundle)</button>
          </div>
        </div>
      `).join("");

      grid.onclick = (e)=>{
        const join = e.target.closest("button[data-cta]");
        const add  = e.target.closest("button[data-cta-cart]");
        if (join){
          const id = join.getAttribute("data-cta");
          const link = PAYMENT_LINKS[id];
          if (link){ location.href = link; return; }
          const m = MISSIONS.find(x=>x.id===id);
          if (m) alert(`${m.title}\n\nRequirement: ${m.packs} packs\nReward: ${m.reward}\n\n(Add your Stripe Payment Link in the script to enable direct checkout.)`);
        }
        if (add){
          const id = add.getAttribute("data-cta-cart");
          const m  = MISSIONS.find(x=>x.id===id);
          if (!m) return;
          const pseudoId = `bundle-${id}`;
          ensureBundleProduct(pseudoId, `${m.title} (${m.packs} packs)`, m.packs * PRICE_PER_PACK);
          addToCart(pseudoId);
          setTimeout(()=>{ window.triggerSmoke && window.triggerSmoke(); }, 0);
        }
      };
    }

    /* Render orchestrator */
    function render(){
      const st = getState();

      // tab styles
      [...tabs.querySelectorAll("button")].forEach(b=>{
        b.style.borderColor = (b.dataset.cat===st.cat) ? "#6366f1" : "var(--border)";
      });

      if (st.cat === "Mission Patches"){ renderMissions(); return; }
      if (filterRow) filterRow.style.display = "";

      const filtered = applyFilters(PRODUCTS, st);
      const pages = Math.max(1, Math.ceil(filtered.length / PAGE_SIZE));
      const cur = Math.min(st.page, pages);
      const start = (cur-1) * PAGE_SIZE;
      const pageItems = filtered.slice(start, start + PAGE_SIZE);

      renderGrid(pageItems);
      renderPager(filtered.length, st);
      pager.style.display = "";
    }

    /* Events */
    tabs.addEventListener("click", (e)=>{
      const btn = e.target.closest("button[data-cat]"); if(!btn) return;
      setState({ cat: btn.dataset.cat, page: 1 });
      setTimeout(()=>{ window.triggerSmoke && window.triggerSmoke(); }, 0);
    });
    pager.addEventListener("click", (e)=>{
      const btn = e.target.closest("button[data-page]"); if(!btn) return;
      setState({ page: parseInt(btn.dataset.page,10) });
      setTimeout(()=>{ window.triggerSmoke && window.triggerSmoke(); }, 0);
    });
    searchInput.addEventListener("input", (e)=> setState({ q: e.target.value, page: 1 }));
    sortSel.addEventListener("change", (e)=> setState({ sort: e.target.value, page: 1 }));

    /* Cart */
    const cartKey = 'rcj.cart';
    function loadCart(){ try{ return JSON.parse(localStorage.getItem(cartKey) || '[]'); }catch{return []} }
    function saveCart(items){ localStorage.setItem(cartKey, JSON.stringify(items)); updateCartUI(); }
    function addToCart(id){
      const items = loadCart();
      const found = items.find(x=>x.id===id);
      if (found) found.qty++;
      else items.push({ id, qty:1 });
      saveCart(items);
    }
    function updateCartUI(){
      const cartItems = document.getElementById('cartItems');
      const cartTotal = document.getElementById('cartTotal');
      const cartCount = document.getElementById('cartCount');
      const items = loadCart().map(it=>{
        const p = PRODUCTS.find(x=>x.id===it.id);
        return p ? { ...it, ...p } : { ...it, title: it.id, price: 0 };
      });
      if (cartItems){
        cartItems.innerHTML = items.map(it=>`
          <div style="display:flex;align-items:center;justify-content:space-between;border-bottom:1px solid var(--border);padding:.5rem 0">
            <div><div>${it.title}</div><div class="badge">Qty: ${it.qty}</div></div>
            <div style="display:flex;align-items:center;gap:.5rem">
              <strong>$${(it.price*it.qty).toFixed(2)}</strong>
              <button class="btn-ghost btn" data-remove="${it.id}">Remove</button>
            </div>
          </div>`).join('');
        const total = items.reduce((s,it)=> s + (Number(it.price)||0)*it.qty, 0);
        if (cartTotal) cartTotal.textContent = total.toFixed(2);
        const count = items.reduce((s,it)=> s + it.qty, 0);
        if (cartCount) cartCount.textContent = count;
      }
    }
    document.getElementById('product-grid').addEventListener('click', (e)=>{
      const add = e.target.closest('.add'); if(!add) return;
      const card = e.target.closest('.pitem'); addToCart(card.getAttribute('data-id'));
      setTimeout(()=>{ window.triggerSmoke && window.triggerSmoke(); }, 0);
    });
    const cartItemsEl = document.getElementById('cartItems');
    if (cartItemsEl){
      cartItemsEl.addEventListener('click', (e)=>{
        const rm = e.target.getAttribute('data-remove'); if(!rm) return;
        let items = loadCart().filter(x=>x.id!==rm); saveCart(items);
      });
    }
    document.getElementById('cartBtn').onclick = ()=> document.getElementById('cartDrawer').classList.add('open');
    document.getElementById('closeCartBtn').onclick = ()=> document.getElementById('cartDrawer').classList.remove('open');
    document.getElementById('checkoutBtn').onclick = ()=>{
      alert('Payments: add Stripe Payment Links to PAYMENT_LINKS or integrate a backend. This is a static demo.');
    };

    /* First paint */
    render();
    updateCartUI();

    /* HERO rotation (Top Sellers + Deals) */
    (function(){
      const hero = document.getElementById("hero"); if (!hero) return;
      const titleEl = hero.querySelector("h1");
      const descEl  = hero.querySelector("p");
      const byPop = PRODUCTS.slice().sort((a,b)=>b.popular - a.popular);
      const top5  = byPop.slice(0,5);
      const deals = PRODUCTS.filter(p => p.price <= 13.5).slice(0,5);
      const slides = [...top5, ...deals];
      let i=0;
      setInterval(()=>{
        const s = slides[i % slides.length];
        if (titleEl) titleEl.textContent = s ? s.title : "Rocket City Jerky";
        if (descEl)  descEl.textContent  = s ? `From $${s.price.toFixed(2)} ‚Ä¢ ${s.cat}` : "Bold flavors. North Alabama made.";
        i++;
      }, 5000);
    })();
  })();
  </script>

  <!-- SmokeFX (cleaner, lighter, never blocks) -->
  <script>
  (function(){
    const overlay = document.getElementById("transition");
    const c = document.getElementById("smokefx");
    if (!overlay || !c) return;
    const ctx = c.getContext("2d");
    let W=0, H=0, DPR=Math.min(devicePixelRatio||1,2);
    function resize(){
      W = c.width  = innerWidth * DPR;
      H = c.height = innerHeight * DPR;
      c.style.width  = innerWidth + "px";
      c.style.height = innerHeight + "px";
      ctx.setTransform(1,0,0,1,0,0);
      ctx.scale(DPR,DPR);
    }
    addEventListener("resize", resize); resize();

    const parts = [];
    const maxAge = 900; // ms
    function spawnBurst(){
      const baseY = innerHeight * 0.85;
      const baseX = innerWidth * 0.5;
      const n = 180; // reduced density
      for (let i=0;i<n;i++){
        const ang = Math.PI * (0.85 + Math.random()*0.3);
        const spd = 1 + Math.random()*3.5;
        parts.push({
          x: baseX + (Math.random()*40-20),
          y: baseY + (Math.random()*10-5),
          vx: Math.cos(ang)*spd,
          vy: Math.sin(ang)*spd - 0.5,
          r:  8 + Math.random()*24,
          a:  0.10 + Math.random()*0.16,
          born: performance.now() + Math.random()*120
        });
      }
    }

    let playing = false, raf=null, start=0;
    function frame(now){
      if (!playing) return;
      ctx.clearRect(0,0,innerWidth,innerHeight);
      // subtle dark wash for depth
      ctx.fillStyle="rgba(5,6,10,0.10)";
      ctx.fillRect(0,0,innerWidth,innerHeight);

      ctx.globalCompositeOperation = "lighter";
      for (let i=parts.length-1;i>=0;i--){
        const p = parts[i];
        if (now < p.born) continue;
        const age = now - p.born;
        const fade = Math.max(0, 1 - (age / maxAge));

        // motion
        p.x += p.vx; p.y += p.vy;
        p.vy -= 0.008;
        p.vx += (Math.sin((p.y + now*0.05)/50))*0.02;

        // softer plume
        const base = 0.30 * p.a * fade;
        const grd = ctx.createRadialGradient(p.x,p.y,0,p.x,p.y,p.r);
        grd.addColorStop(0, `rgba(255,255,255,${base})`);
        grd.addColorStop(0.55, `rgba(200,200,200,${base*0.35})`);
        grd.addColorStop(1, `rgba(150,150,150,0)`);
        ctx.fillStyle = grd;
        ctx.beginPath(); ctx.arc(p.x,p.y,p.r,0,Math.PI*2); ctx.fill();

        if (age > maxAge) parts.splice(i,1);
      }
      ctx.globalCompositeOperation = "source-over";

      // finish
      if (now - start > 700 && parts.length === 0) {
        overlay.style.opacity = "0";
        setTimeout(()=>{ overlay.style.opacity="0"; overlay.style.display="none"; playing=false; }, 120);
        return;
      }
      raf = requestAnimationFrame(frame);
    }

    function triggerSmoke(){
      overlay.style.display = "block";
      overlay.style.opacity = "1";
      parts.length = 0; start = performance.now(); spawnBurst();
      if (!playing) { playing = true; raf && cancelAnimationFrame(raf); raf = requestAnimationFrame(frame); }
    }

    // hook after state changes so it never hides the grid paint
    const tabs = document.getElementById("cat-tabs");
    if (tabs) tabs.addEventListener("click", (e)=>{ if (e.target.closest("button[data-cat]")) setTimeout(triggerSmoke,0); });
    const pager = document.getElementById("pager");
    if (pager) pager.addEventListener("click", (e)=>{ if (e.target.closest("button[data-page]")) setTimeout(triggerSmoke,0); });
    document.querySelectorAll('[data-route="home"], [data-route="shop"]').forEach(a=> a.addEventListener("click", ()=> setTimeout(triggerSmoke,0)));

    window.triggerSmoke = triggerSmoke;
  })();
  </script>
<!-- PlanetsFX: realistic rotating planets that drift across the hero -->
<script>
(function(){
  const canvas = document.getElementById('planetsfx');
  if(!canvas) return;
  const ctx = canvas.getContext('2d');

  let W = 0, H = 0, DPR = Math.min(window.devicePixelRatio || 1, 2);
  const reduced = window.matchMedia('(prefers-reduced-motion: reduce)').matches;

  function resize(){
    const hero = document.getElementById('hero');
    if(!hero) return;
    const rect = hero.getBoundingClientRect();
    W = canvas.width  = Math.floor(rect.width  * DPR);
    H = canvas.height = Math.floor(rect.height * DPR);
    canvas.style.width  = rect.width  + 'px';
    canvas.style.height = rect.height + 'px';
    ctx.setTransform(1,0,0,1,0,0);
    ctx.scale(DPR, DPR);
  }
  addEventListener('resize', resize); resize();

  // --- Texture sources (public NASA/SpaceX style). You can swap to your own textures anytime.
  // Square-ish textures work best. Keep file sizes reasonable (<1MB).
  const textures = [
    // Mars
    'https://images-assets.nasa.gov/image/PIA00407/PIA00407~orig.jpg',
    // Earth night/day montage (for subtle detail)
    'https://upload.wikimedia.org/wikipedia/commons/0/02/Blue_Marble_Eastern_Hemisphere.jpg',
    // Jupiter
    'https://upload.wikimedia.org/wikipedia/commons/e/e2/Jupiter.jpg'
  ];

  // Load images
  function load(src){ return new Promise((resolve,reject)=>{ const i=new Image(); i.crossOrigin='anonymous'; i.onload=()=>resolve(i); i.onerror=reject; i.src=src; }); }
  Promise.all(textures.map(load)).then((imgs)=>start(imgs)).catch(()=>{/* fail silently */});

  function start(imgs){
// Build planet instances (randomized)
const planets = Array.from({ length: 5 }, () => {
  const img = imgs[Math.floor(Math.random() * imgs.length)];
  const radius = rand(90, 220);                     // 90‚Äì220 px
  const spin   = rand(0.009, 0.020) * (Math.random() < 0.5 ? -1 : 1); // cw/ccw
  const xNorm  = rand(0.05, 0.95);                  // anywhere across hero
  const yNorm  = rand(0.25, 0.80);                  // keep in vertical band
  const driftX = rand(-0.12, 0.12);                 // left or right
  return makePlanet(img, radius, spin, xNorm, yNorm, driftX);
});


    let last = performance.now();
    function frame(now){
      if (!canvas.isConnected) return; // in case hero unmounts
      const dt = Math.min((now - last)/1000, 0.033); last = now;

      // Clear
      ctx.clearRect(0,0,W/DPR,H/DPR);

      // Draw each planet
      for (const p of planets){
        updatePlanet(p, dt);
        drawPlanet(p);
      }

      if(!reduced) requestAnimationFrame(frame);
    }
    if(!reduced) requestAnimationFrame(frame);
    else { // draw a static frame for reduced motion
      planets.forEach(drawPlanet);
    }
  }

  // Make a planet
  function makePlanet(img, radius, spin, xNorm, yNorm, driftX){
    // xNorm,yNorm are relative positions on hero (0..1)
    const planet = {
      img,
      r: radius,             // px at 1x (we draw in CSS px, DPR handled by context scale)
      spin,                  // radians per sec
      angle: Math.random()*Math.PI*2,
      // position in CSS pixels (not DPR)
      x: xNorm * (canvas.width / DPR),
      y: yNorm * (canvas.height/ DPR),
      // drift across screen (px/sec)
      vx: driftX * 40,       // slow pan looks cinematic
      // lighting
      lightDir: [-0.6, -0.1], // normalized light (from top-left)
      // parallax wobble
      wobble: 6 + Math.random()*8,
      wobbleT: Math.random()*Math.PI*2
    };
    return planet;
  }

  function updatePlanet(p, dt){
    p.angle += p.spin * (dt*60/60); // keep constant-ish speed
    p.x     += p.vx   * dt;
    p.wobbleT += dt*0.7;
// respawn anywhere when off-screen for more variety
const viewW = canvas.width / DPR, viewH = canvas.height / DPR;
const off = p.r * 1.6;

if (p.x < -off || p.x > viewW + off) {
  // new random attributes
  p.r     = rand(90, 220);
  p.spin  = rand(0.009, 0.020) * (Math.random() < 0.5 ? -1 : 1);
  p.vx    = rand(-0.12, 0.12) * 40;
  p.angle = Math.random() * Math.PI * 2;

  // re-enter from random side to a random position
  const fromLeft = Math.random() < 0.5;
  p.x = fromLeft ? -off : viewW + off;
  p.y = rand(0.25 * viewH, 0.80 * viewH);
}

  function clamp(min,max,v){ return Math.max(min, Math.min(max, v)); }

  // Draw a textured, shaded ‚Äúsphere‚Äù in 2D:
  // 1) clip a circular path
  // 2) paint a horizontally ‚Äúrotated‚Äù texture by shifting its x offset
  // 3) multiply a radial vignette and a directional light to give volume
  function drawPlanet(p){
    const ctxPx = ctx; // we already scaled by DPR at resize

    const x = p.x + Math.sin(p.wobbleT)*p.wobble*0.4;
    const y = p.y + Math.cos(p.wobbleT*0.7)*p.wobble*0.25;
    const r = p.r;

    // 1) Clip a circle
    ctxPx.save();
    ctxPx.beginPath();
    ctxPx.arc(x, y, r, 0, Math.PI*2);
    ctxPx.closePath();
    ctxPx.clip();

    // 2) Paint rotated texture by shifting the source x offset
    const img = p.img;
    if (img && img.width){
      // We ‚Äúspin‚Äù by scrolling the texture horizontally
      const offset = Math.floor((p.angle/(Math.PI*2)) * img.width) % img.width;
      // Draw twice to wrap seamlessly
      const scale = (r*2) / img.height;           // scale so image height fits diameter
      const drawW = img.width * scale;
      const drawH = img.height * scale;
      const left  = x - r - drawW + (offset*scale);
      ctxPx.drawImage(img, left,        y - r, drawW, drawH);
      ctxPx.drawImage(img, left+drawW,  y - r, drawW, drawH);
    }

    // 3a) Vignette to give spherical shading
    const vignette = ctxPx.createRadialGradient(x, y, r*0.2, x, y, r);
    vignette.addColorStop(0, 'rgba(0,0,0,0)');
    vignette.addColorStop(1, 'rgba(0,0,0,0.35)');
    ctxPx.globalCompositeOperation = 'multiply';
    ctxPx.fillStyle = vignette;
    ctxPx.beginPath(); ctxPx.arc(x,y,r,0,Math.PI*2); ctxPx.fill();

    // 3b) Directional light: bright rim on the light-facing side
    const lx = p.lightDir[0], ly = p.lightDir[1];
    const nx = -lx, ny = -ly; // rim opposite shadow
    const grad = ctxPx.createLinearGradient(x - nx*r, y - ny*r, x + nx*r, y + ny*r);
    grad.addColorStop(0,   'rgba(255,255,255,0.35)');
    grad.addColorStop(0.5, 'rgba(255,255,255,0.10)');
    grad.addColorStop(1,   'rgba(0,0,0,0.0)');
    ctxPx.fillStyle = grad;
    ctxPx.globalCompositeOperation = 'screen';
    ctxPx.beginPath(); ctxPx.arc(x,y,r,0,Math.PI*2); ctxPx.fill();

    ctxPx.restore();
    ctxPx.globalCompositeOperation = 'source-over';
  }
})();
</script>

  <!-- Starfield background (dense, responsive) -->
  <script>
  (function(){
    const canvas = document.getElementById('bgfx'); if (!canvas) return;
    const ctx = canvas.getContext('2d', { alpha: true });
    let W = canvas.width = innerWidth, H = canvas.height = innerHeight;
    const reduced = matchMedia('(prefers-reduced-motion: reduce)').matches;
    const DPR = Math.min(devicePixelRatio || 1, 2);
    canvas.width = W * DPR; canvas.height = H * DPR; ctx.scale(DPR, DPR);

    const STAR_COUNT = reduced ? 200 : 800;
    const METEOR_RATE = reduced ? 0.0006 : 0.0012;
    const GALAXY_COUNT = reduced ? 2 : 4;
    const GRAVITY_RADIUS = 140;
    const GRAVITY_STRENGTH = 0.04;

    const mouse = { x: W * 0.5, y: H * 0.5, active: false };
    addEventListener('mousemove', e => { mouse.x = e.clientX; mouse.y = e.clientY; mouse.active = true; });
    addEventListener('mouseleave', () => { mouse.active = false; });

    const stars = []; const meteors = []; const galaxies = []; let iss;
    const rand=(a,b)=>Math.random()*(b-a)+a;

    function makeStar(){ const z=Math.random()*0.8+0.2;
      return {x:Math.random()*W,y:Math.random()*H,z,size:rand(0.6,1.6)*z,vx:(Math.random()*0.3+0.05)*z,vy:(Math.random()*0.2-0.1)*z,tw:Math.random()*Math.PI*2};
    }
    function makeGalaxy(){ const r=rand(120,220);
      return {x:Math.random()*W,y:Math.random()*H*0.7,r,rot:rand(0,Math.PI*2),vr:rand(-0.0004,0.0004),hue:rand(200,320),alpha:rand(0.06,0.12)};
    }
    function spawnMeteor(){ const top=Math.random()<0.5; const x=rand(-100,W*0.2); const y=top?rand(-60,H*0.3):rand(H*0.7,H+60); const s=rand(6,10);
      const a=top?rand(Math.PI*0.1,Math.PI*0.3):rand(-Math.PI*0.3,-Math.PI*0.1);
      meteors.push({x,y,vx:Math.cos(a)*s,vy:Math.sin(a)*s,birth:performance.now()});
    }
    function makeISS(){ return {t:0,speed:reduced?0.00003:0.00006,size:24,path:(t)=>({x:W*(0.1+0.8*((1-Math.cos(2*Math.PI*t))/2)),y:H*(0.3+0.2*Math.sin(4*Math.PI*t))})};}

    for(let i=0;i<STAR_COUNT;i++) stars.push(makeStar());
    for(let i=0;i<GALAXY_COUNT;i++) galaxies.push(makeGalaxy());
    iss=makeISS();

    function drawStar(s){ s.tw+=0.05; const tw=0.7+0.3*Math.sin(s.tw+s.z*5); ctx.globalAlpha=0.6*s.z*tw; ctx.fillStyle="#fff"; ctx.fillRect(s.x,s.y,s.size,s.size); ctx.globalAlpha=1;}
    function drawGalaxy(g){ g.rot+=g.vr; const grad=ctx.createRadialGradient(g.x,g.y,0,g.x,g.y,g.r);
      grad.addColorStop(0,`hsla(${g.hue},80%,70%,${g.alpha})`); grad.addColorStop(0.35,`hsla(${g.hue+40},70%,60%,${g.alpha*0.8})`); grad.addColorStop(1,`hsla(${g.hue},90%,50%,0)`);
      ctx.save(); ctx.translate(g.x,g.y); ctx.rotate(g.rot); ctx.globalCompositeOperation="lighter"; ctx.fillStyle=grad; ctx.beginPath(); ctx.ellipse(0,0,g.r*1.2,g.r*0.7,0,0,Math.PI*2); ctx.fill(); ctx.restore(); ctx.globalCompositeOperation="source-over";
    }
    function drawMeteor(m){ ctx.save(); ctx.translate(m.x,m.y); ctx.rotate(Math.atan2(m.vy,m.vx)||0);
      const len=80; const grad=ctx.createLinearGradient(0,0,-len,0); grad.addColorStop(0,"rgba(255,255,255,0.95)"); grad.addColorStop(1,"rgba(255,180,120,0)");
      ctx.strokeStyle=grad; ctx.lineWidth=2; ctx.beginPath(); ctx.moveTo(0,0); ctx.lineTo(-len,0); ctx.stroke(); ctx.restore(); }

    let last=performance.now(); const meteorMaxAge=1200;
    function frame(now){
      const dt=Math.min((now-last)/1000,0.033); last=now;
      ctx.clearRect(0,0,innerWidth,innerHeight);
      galaxies.forEach(drawGalaxy);

      for(const s of stars){
        s.x+=s.vx; s.y+=s.vy;
        if(s.x>W+5) s.x=-5; if(s.y<-5) s.y=H+5; if(s.y>H+5) s.y=-5;
        if(mouse.active){ const dx=mouse.x-s.x, dy=mouse.y-s.y, d2=dx*dx+dy*dy;
          if(d2<GRAVITY_RADIUS*GRAVITY_RADIUS){ const d=Math.sqrt(d2)||1; s.vx+=(dx/d)*GRAVITY_STRENGTH*s.z; s.vy+=(dy/d)*GRAVITY_STRENGTH*s.z; } }
        drawStar(s); s.vx*=0.998; s.vy*=0.998;
      }

      if(!reduced && Math.random()<METEOR_RATE) spawnMeteor();
      for(let i=meteors.length-1;i>=0;i--){
        const m=meteors[i]; m.x+=m.vx; m.y+=m.vy; drawMeteor(m);
        if(now - m.birth > meteorMaxAge || m.x>W+120 || m.x<-120 || m.y<-120 || m.y>H+120) meteors.splice(i,1);
      }

      iss.t=(iss.t+iss.speed)%1;
      const p=iss.path(iss.t); ctx.save(); ctx.translate(p.x,p.y); ctx.rotate(Math.sin(iss.t*Math.PI*2)*0.1);
      ctx.fillStyle="#cfd8ff"; ctx.strokeStyle="#9fb3ff"; ctx.lineWidth=1.2;
      ctx.fillRect(-iss.size*0.15,-iss.size*0.15,iss.size*0.3,iss.size*0.3);
      ctx.fillStyle="#7aa6ff"; ctx.fillRect(-iss.size*0.9,-iss.size*0.12,iss.size*0.55,iss.size*0.24); ctx.fillRect(iss.size*0.35,-iss.size*0.12,iss.size*0.55,iss.size*0.24);
      ctx.beginPath(); ctx.moveTo(-iss.size*0.35,-iss.size*0.1); ctx.lineTo(iss.size*0.35,-iss.size*0.1); ctx.moveTo(-iss.size*0.35,iss.size*0.1); ctx.lineTo(iss.size*0.35,iss.size*0.1); ctx.stroke(); ctx.restore();

      if(!reduced) requestAnimationFrame(frame);
    }
    requestAnimationFrame(frame);

    addEventListener("resize",()=>{
      W=canvas.width=innerWidth; H=canvas.height=innerHeight;
      canvas.width=W*DPR; canvas.height=H*DPR; ctx.setTransform(1,0,0,1,0,0); ctx.scale(DPR,DPR);
    });
    addEventListener("click",()=>{ if(!reduced) spawnMeteor(); });
  })();
  </script>
</body>
</html>
